<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.reprice_backend.mapper.UserMapper">

    <resultMap id="UserResultMap" type="com.example.reprice_backend.entity.User">
        <id property="userId" column="user_id" />
        <result property="email" column="email" />
        <result property="displayName" column="display_name" />
        <result property="provider" column="provider" />
        <result property="providerUserId" column="provider_user_id" />
        <result property="role" column="role" />
        <result property="status" column="status" />
        <result property="createDt" column="create_dt" />
        <result property="updateDt" column="update_dt" />
    </resultMap>

    <select id="getUserByUserId" resultMap="UserResultMap" >
        select
            *
        from
            user_tb
        where
            user_id = #{userId}
    </select>

    <select id="getUserByEmail" resultMap="UserResultMap" >
        select
            *
        from
            user_tb
        where
            email = #{email}
    </select>

    <select id="getUserByDisplayName" resultMap="UserResultMap" >
        select
            *
        from
            user_tb
        where
            display_name = #{displayName}
    </select>

    <select id="getUserByProviderAndProviderUserId" resultMap="UserResultMap" >
        select
            *
        from
            user_tb
        where
            provider = #{provider} and provider_user_id = #{providerUserId};
    </select>

    <insert id="addUser" useGeneratedKeys="true" keyProperty="userId" >
        insert into
            user_tb
        values
            (0, #{email}, #{displayName}, #{provider}, #{providerUserId}, "ROLE_USER", "ACTIVE", now(), now());
    </insert>

    <update id="updateUser" >
        update
            user_tb
        set
            password = #{password},
            display_name = #{displayName},
            status = #{status},
            update_dt = now()
        where
            user_id = #{userId};
    </update>
</mapper>