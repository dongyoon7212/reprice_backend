<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.reprice_backend.mapper.ChatMessageMapper">

    <resultMap id="ChatMessageResultMap" type="com.example.reprice_backend.entity.ChatMessage">
        <id property="chatMessageId" column="chat_message_id" />
        <result property="chatRoomId" column="chat_room_id" />
        <result property="senderId" column="sender_id" />
        <result property="messageType" column="message_type" />
        <result property="content" column="content" />
        <result property="sentDt" column="sent_dt" />
    </resultMap>

    <insert id="addChatMessage" useGeneratedKeys="true" keyProperty="chatMessageId">
        insert into
            chat_message_tb
        values (
            0,
            #{chatRoomId},
            #{senderId},
            #{messageType},
            #{content},
            #{sentDt}
        );
    </insert>

    <select id="getChatMessages" resultMap="ChatMessageResultMap">
        select
            *
        from
            chat_message_tb
        where
            chat_room_id = #{chatRoomId}
            <if test="cursorMessageId != null">
                and chat_message_id <![CDATA[ < ]]> #{cursorMessageId}
            </if>
        order by
            chat_message_id desc
        limit #{limit};
    </select>
</mapper>
